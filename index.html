<!DOCTYPE html>
<html class="theme-dark">
	<head>
		<link type="text/css" rel="stylesheet" href="https://mwittrien.github.io/_res/css/discord.css"></link>
		<link type="text/css" rel="stylesheet" href="https://mwittrien.github.io/_res/css/main.css"></link>
		<style></style>
		<script>
			window.onload = function () {
				const createElement = html => {
					if (typeof html != "string" || !html.trim()) return null;
					let template = document.createElement("template");
					try {template.innerHTML = html.replace(/(?<!pre)>[\t\r\n]+<(?!pre)/g, "><");}
					catch (err) {template.innerHTML = html.replace(/>[\t\r\n]+<(?!pre)/g, "><");}
					if (template.content.childNodes.length == 1) return template.content.firstElementChild || template.content.firstChild;
					else {
						let wrapper = document.createElement("span");
						let nodes = Array.from(template.content.childNodes);
						while (nodes.length) wrapper.appendChild(nodes.shift());
						return wrapper;
					}
				};
				const formatClassName = (...classes) => {
					return [...new Set(classes.flat(10).filter(n => n).join(" ").split(" "))].join(" ").trim();
				};
				
				const createSpinner = wrap => {
					return createElement(`${wrap ? '<div class="spinner-container">' : ''}<span class="spinner"><span class="spinner-inner"><span class="spinner-item"></span><span class="spinner-item"></span></span></span>${wrap ? '</div>' : ''}`);
				};
				const createLoadingList = (url, getHeader, getChildren) => {
					let header = createElement(`<div class="header">${typeof getHeader == "function" ? getHeader(0) : getHeader}</div>`);
					let list = createElement(`<div></div>`);
					list.appendChild(createSpinner(true));
					
					const xhttp = new XMLHttpRequest();
					xhttp.onload = function() {
						if (!document.contains(list)) return;
						try {
							while (list.childElementCount) list.firstElementChild.remove();
							list.classList.add("addon-list");
							let children = [getChildren(this.response)].flat(10).filter(n => n);
							for (let child of children) list.appendChild(child);
							header.innerText = typeof getHeader == "function" ? getHeader(children.length) : getHeader;
						}
						catch (err) {console.error("Error:", err);}
					};
					xhttp.open("GET", url);
					xhttp.send();
					
					return [header, list];
				};
				const createLibraryEntry = _ => {
					return createLoadingList("https://mwittrien.github.io/BetterDiscordAddons/Library/README.md", "Required Library", response => {
						let parsedResponse = response.trim().replace(/\r/g, "");
						return createAddonCard({
							name: (parsedResponse.split(" -")[0] || "").replace("# ", ""),
							description: parsedResponse.split("\n").pop(),
							buttons: [{
								svg: `<svg viewBox="0 0 24 24" class=""><path fill="currentColor" d="M 16.293,9.2929995 17.707,10.707 12,16.414 6.29297,10.707 7.70697,9.2929995 11,12.586 V 1.9999995 h 2 V 12.586 Z M 18,20 v -2 h 2 v 2 c 0,1.102 -0.896,2 -2,2 H 6 C 4.896,22 4,21.102 4,20 v -2 h 2 v 2 z" class=""></path></svg>`,
								onClick: _ => window.open("https://mwittrien.github.io/downloader/?library", "_target")
							}]
						});
					});
				};
				const createAddonList = type => {
					return createLoadingList(`https://mwittrien.github.io/BetterDiscordAddons/${type}/README.md`, amount => `${type} - ${amount}`, response => {
						return response.split("- [").splice(1).map(n => {
							let m = n.split("](");
							let l = m[1].split(") - ");
							return createAddonCard({
								name: m[0],
								description: l[1],
								buttons: [{
									svg: `<svg viewBox="0 0 24 24" class=""><path fill="currentColor" d="M 16.293,9.2929995 17.707,10.707 12,16.414 6.29297,10.707 7.70697,9.2929995 11,12.586 V 1.9999995 h 2 V 12.586 Z M 18,20 v -2 h 2 v 2 c 0,1.102 -0.896,2 -2,2 H 6 C 4.896,22 4,21.102 4,20 v -2 h 2 v 2 z" class=""></path></svg>`,
									onClick: _ => window.open(`https://mwittrien.github.io/downloader/?${type.toLowerCase().slice(0, -1)}=${l[0].split("/").pop()}`, "_target")
								}]
							});
						});
					});
				};
				const createAddonCard = addon => {
					let card = createElement(`<div class="addon-card" role="button" tabindex="0">
						<div class="addon-header">
							<div class="addon-image-wrapper">
								<img class="addon-image" src="" alt="">
							</div>
							<div class="addon-icon-wrapper">
								<img class="addon-icon" src="" alt="">
							</div>
						</div>
						<div class="addon-info">
							<div class="addon-title">
								<div class="addon-name">${addon.name}</div>
							</div>
							<div class="addon-description">${addon.description}</div>
							<div class="addon-controls">
								<div class="addon-links"></div>
								<div class="addon-buttons"></div>
							</div>
						</div>
					</div>`);
					let links = card.querySelector(".addon-links");
					let buttons = card.querySelector(".addon-buttons");
					if (addon.links) for (let link of addon.links) {
						let linkEle = createElement(`<div class="addon-link">${link.svg}</div>`);
						if (link.url) linkEle.addEventListener("click", _ => window.open(addon.url, "_target"));
						links.appendChild(linkEle);
					}
					if (addon.buttons) for (let button of addon.buttons) {
						let buttonEle = createElement(`<div class="addon-button">${button.svg}</div>`);
						if (button.onClick) buttonEle.addEventListener("click", button.onClick);
						buttons.appendChild(buttonEle);
					}
					return card;
				};
				
				const sidebar = document.querySelector(".sidebar-region .sidebar");
				const content = document.querySelector(".content-region .content");
				
				const sections = [
					{section: "General", renderSection: _ => {}},
					{section: "Separator"},
					{section: "Plugins", renderSection: _ => [createAddonList("Plugins"), createElement(`<div class="divider"></div>`), createLibraryEntry()]},
					{section: "Themes", renderSection: _ => createAddonList("Themes")},
					{section: "Separator"},
					{section: "Generator", renderSection: _ => {}}
				];
				let selectedSection = sections[0].section;
				let items = [];
				
				for (const data of sections) {
					const item = createElement(data.renderSection ? `<div class="${formatClassName("sidebar-item", selectedSection == data.section && "selected")}">${data.section}</div>` : `<div class="sidebar-separator"></div>`);
					if (data.renderSection) {
						items.push(item);
						item.addEventListener("click", _ => {
							while (content.childElementCount) content.firstElementChild.remove();
							let sectionElements = [data.renderSection()].flat(10).filter(n => n);
							for (let element of sectionElements) content.appendChild(element);
							for (let i of items) i.classList.remove("selected");
							item.classList.add("selected");
							selectedSection = data.section;
						});
					}
					sidebar.appendChild(item);
				}
			};
		</script>
	</head>
	<body>
		<div class="app-mount">
			<div class="app-container">
				<div class="app">
					<div class="bg"></div>
					<div class="layers">
						<div class="layer">
							<div class="sidebar-view">
								<div class="sidebar-region">
									<div class="scroller fade">
										<div class="sidebar"></div>
									</div>
								</div>
								<div class="content-region">
									<div class="scroller auto">
										<div class="content"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>